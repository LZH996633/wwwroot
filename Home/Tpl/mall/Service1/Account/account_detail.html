
<!--显示标识-->
<span id="show_project" data-value="{$show_project}"></span>
<!--排序标识-->
<span id="order" data-value="{$order}"></span>
<!--开始时间-->
<span id="start_time" data-value="{$start_time}"></span>
<!--结束时间-->
<span id="end_time" data-value="{$end_time}"></span>
<div class="rtmain">

        <div class="hdtitle clearfix">
            <ul class="fl clearfix">
                <li ><a href="javascript:void(0);" class="inter_chanView" data-value="Recharge">账户充值</a></li>
                <li class="on"><a href="javascript:void(0);" class="inter_chanView" data-value="AccountDetail">账务明细</a></li>
                <li><a href="javascript:void(0);" class="inter_chanView" data-value="AccountSafe">账户安全</a></li>
            </ul>
            <span>账户余额：<i>{$AccInfo.gold_coin}</i> 金币</span>
        </div>
        <div class="conts">
            <div class="tabconts">
                <ul class="title clearfix">
                    <li class="active" id="fit"><a href="javascript:void (0)">充值记录</a></li>
                    <li><a href="javascript:void (0)">消费记录</a></li>
                    <li><a href="javascript:void (0)">收支汇总</a></li>
                </ul>
             </div>
        <div class="list_show">
            <div class="lists">
            <div class="tabcts">
            <div class="clearfix">
                <form method="get" id="form_one">
                    <ul class="clearfix fl">
                        <li>订单时间</li>
                        <li><input type="text" value="{$recharge_start}" readonly id="start_one" class="laydate-icon" ></li>
                        <li>到</li>
                        <li><input type="text" value="{$recharge_end}" readonly id="end_one"  class="laydate-icon" ></li>
                        <li><select class ="order">
                            <option value="" selected>全部状态</option>
                            <option value="0" >交易未支付</option>
                            <option value="3" >交易成功</option>
                            <option value="2" >等待付款</option>
                            <option value="1" >交易处理中</option>
                            </select></li>
                    </ul>
                    <a href="javascript:do_submit_one();" >查询</a>
                </form>
            </div>
        </div>
            <!-- <div class="tips">备注：如需下载积分素材，可用金币兑换积分（数量可选）</div>-->
            <div class="tabs">
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <th width="24%">订单号</th>
                        <th width="23%">时间</th>
                        <th width="10%">充值方式</th>
                        <th width="12%">金额</th>

                        <th width="15%">订单状态</th>
                        <th width="18%">操作</th>
                    </tr>
                   <volist name="RechargeList" id="list">
                       <tr>
                           <td class="ts"><span>{$list.acct_order}</span></td>
                           <td>{$list.acct_time}</td>
                           <td>
                               <switch name="list.acct_method">
                                   <case value="1">支付宝支付</case>
                                   <case value="2">微信支付</case>
                                   <case value="3">银行转账</case>
                                   <default />保密方式
                               </switch>
                               </td>
                           <td>{$list.acct_money}元</td>
                           <td>
                               <switch name="list.acct_status">
                                   <case value="0"><i ><font color="red" class="onError">交易未支付</font></i></case>
                                   <case value="1"><i ><font  class="onFocus">交易处理中</font></i></case>
                                   <case value="2"><i ><font color="orange" class="onTime">等待付款</font></i></case>
                                   <case value="3"><i class="status"><font  class="onCorrect">交易成功</font></i></case>
                                   <default />系统的处理中
                               </switch>

                           </td>
                           <td>


                               <if condition="$list.acct_status eq 0">
                                   <form action="{:U('Recharge/recharge')}" method="post" id="recharge_{$list.id}" target="_blank">
                                       <input name="pay_type" type="hidden" value="1">
                                       <input name="order" type="hidden" value="{acct_order}">
                                       <input type="hidden" name="type" value="{$list.acct_method}">
                                       <input type="hidden" name="rec_num" value="{$list.acct_money}">

                                   </form>
                                   <a href="javascript:void(0)" onclick="recharge({$list.id})" style="color:#fff;" target="_blank">付款</a>
                                   <a class="bgorange" href="javascript:void(0)" id="cancel_pay" data-value="{$list.id}">取消支付</a>
                               </if>
                           </td>
                       </tr>
                   </volist>

                </table>

                <script type="text/javascript">
                    function recharge(id){
                        var rec = document.getElementById('recharge_'+id);
                        rec.submit();
                    }
                </script>
                <script type="text/javascript">
                    $("#cancel_pay").click(function(){
                        var id = $(this).attr('data-value');
                       $.getJSON('/index.php/Ajax/cancel_pay?id='+id,function(data){
                           if(data.status==1){
                               layer.msg(data.msg,{icon:1})
                           }else{
                               layer.msg(data.msg,{icon:2})
                           }
                       })
                    })


                </script>
            </div>
            <div class="info clearfix">
                <div class="count fl">本页交易：（总计：<em>{$sum_recharge}元</em> ，成功：<em id="complete_total">{$complete_recharge}元</em> ，未完成：<em class="unfinished_total">{$unfinished_recharge}元</em>）</div>
                <div class="pages fr">
                    <if condition="$count_recharge eq 0">
                        <else/><a class="a1">共<span id="page_collect">{$count_recharge}</span>条</a>
                    </if>
                    {$page_recharge}
            </div>
            </div>
            </div>
            <div class="lists" style="display: none">
                <div class="tabcts">
                    <div class="clearfix">
                        <form method="get" id="form_two">
                            <ul class="clearfix fl">
                                <li>订单时间</li>
                                <li><input type="text" value="{$con_start}" readonly id="start_two" class="laydate-icon" ></li>
                                <li>到</li>
                                <li><input type="text" value="{$con_end}" readonly id="end_two"  class="laydate-icon" ></li>
                               <!-- <li>
                                    <select name="type" class="order">
                                        <option value="" >消费类型</option>
                                        <option value="1" >金币</option>
                                        <option value="2" >积分</option>
                                    </select>
                                </li>-->
                            </ul>
                            <a href="javascript:do_submit_two();">查询</a>
                        </form>
                    </div>
                </div>
                <div class="tabs">
                    <table width="100%" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <th width="55%">消费内容</th>
                            <th width="20%">时间</th>
                            <th width="10%">模板类型</th>
                            <th width="15%">消耗金额</th>
                        </tr>
                        <volist name="ConsumeList" id="list">
                        <tr>
                            <td width="55%">{$list.content}</td>
                            <td width="20%">{$list.time}</td>
                            <td width="10%">{$list.model_type}</th>
                            <td width="15%">{$list.money}金币</td>
                        </tr>
                        </volist>
                    </table>
                </div>
                <div class="info clearfix">
                    <div class="count fl">本页总计交易：（金币：<em>{$num_con}</em>）</div>
                    <div class="pages fr">
                        <if condition="$count_con eq 0">
                            <else/><a class="a1">共<span id="">{$count_con}</span>条</a>
                        </if>
                        {$page_con}
                    </div>
                </div>
            </div>
            <div class="lists" style="display: none">

                <div class="tabcts">
                            <div class="clearfix">
                                <form method="get" id="form_three">
                                    <ul class="clearfix fl">
                                        <li>订单时间</li>
                                        <li><input type="text" value="{$total_start}" readonly id="start_three" class="laydate-icon" ></li>
                                        <li>到</li>
                                        <li><input type="text" value="{$total_end}" readonly id="end_three"  class="laydate-icon" ></li>
                                        <li><select name="szlx" class="order">
                                            <option value="" selected="">全部</option>
                                            <option value="1">用户充值</option>
                                            <option value="2">下载模板</option>
                                            <option value="3">收入提现</option>
                                            <option value="4">模板销售</option>
                                            <option value="5">定制收入</option>
                                        </select></li>
                                       <!-- <li><select name="bz">
                                            <option value="" selected="">收支类型</option>
                                            <option value="1">金币</option>
                                            <option value="2">积分</option>
                                            <option value="3">销售/提现</option>
                                            <option value="4">推广</option>
                                            <option value="5">定制</option></select> </li>-->
                                    </ul>
                                    <a href="javascript:do_submit_three();" >查询</a>
                                </form>
                            </div>
                        </div>
                   <!-- <div class="tips">备注：如需下载积分素材，可用金币兑换积分（数量可选）</div>-->
                <div class="tabs">
                    <table width="100%" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <th width="24%">订单号</th>
                            <th width="23%">时间</th>

                            <th width="18%">收支方式</th>
                            <th width="12%">金额</th>
                            <th width="15%">收支状态</th>

                        </tr>
                        <volist name="ConsumeTotal" id="list">
                        <tr>
                            <td class="ts"><span>{$list.order}</span></td>
                            <td>{$list.time}</td>

                            <td>
                                <switch name="list.method">
                                <case value="1">用户充值</case>
                                <case value="2">下载模板</case>
                                <case value="3">收入提现</case>
                                <case value="4">模板销售</case>
                                <case value="5">定制收入</case>
                                <default/>其他途径
                            </switch></td>
                            <td><i><font>{$list.money}</font></i></td>
                            <td>
                                <switch name="list.method_status">
                                    <case value="0">支出</case>
                                    <case value="1">收入</case>
                                </switch>
                               </td>
                        </tr>
                        </volist>
                     </table>
                    </div>

                <div class="info clearfix">
                    <div class="count fl">本页交易：（总计：<em>{$num_total}金币</em> ，收入：<em>{$income}金币</em> ，支出：<em>{$spend}金币</em>）</div>
                    <div class="pages fr">
                        <if condition="$count_total eq 0">
                            <else/><a class="
                            a1">共<span id="page_con">{$count_total}</span>条</a>
                        </if>
                        {$page_total}
                    </div>
                </div>
            </div>
        </div>
           </div>
       </div>


    <script type="text/javascript">

        layer.config({
            extend: 'extend/layer.ext.js'

        });
    </script>
    <!--选项卡-->
    <script type="text/javascript">
    $(document).ready(function (){
                var i= $("#show_project").attr("data-value");

                    $("#show_project").attr("data-value",i);

                    $(".title li").eq(i).attr("class","active").siblings().attr("class","");

                    $(".lists").eq(i).attr("style","display:block").siblings().attr("style","display:none");

            }
    );
    $(".title li").click(function(){
        var i = $(this).index();

        var a= $('#show_project').attr('data-value');
        if (i != a){
            $('#show_project').attr('data-value',i);
            change_page();
        }

        $(this).attr('class','active').siblings().attr('class','');

        $('.lists').eq(i).attr('style','display:block').siblings().attr('style','display:none');
    })


</script>
    <!--筛选-->
    <script type="text/javascript">
    $(document).ready(function () {
        var i = $('#show_project').attr('data-value');

        var up_order = $("#order").attr("data-value");

         var select = $(".lists").eq(i).find(".order option");
        select.each(function () {
            var order = $(this).attr('value');

            if (up_order == order){
                var order_text = $(this).text();
                 if(order!=''){
                    select.eq(0).attr("value",order).text(order_text);
                    select.eq(0).after("<option value=''>全部</option>");
                }

            }/*"<option value="+up_order+">"+order_text+"</option>"*/
        });

    })
</script>

    <!--入账记录日期-->
    <script type="text/javascript">
             var start = {
                elem: '#start_one',
                format: 'YYYY-MM-DD',
                max: '2099-06-16 23:59:59',
                istime: false,
                istoday: true,
                choose: function(datas){
                    end.min = datas;
                    end.start = datas
                }
            };
            var end = {
                elem: '#end_one',
                format: 'YYYY-MM-DD',

                max: '2099-06-16 23:59:59',
                istime: false,
                istoday: true,
                choose: function(datas){
                    start.max = datas;
                }
            };
            laydate(start);
            laydate(end);
            function do_submit_one(){
                var start_time =   $("#form_one #start_one ").val();
                var end_time =   $("#form_one  #end_one ").val();
                var  order = $("#form_one .order").val();
                $("#start_time").attr("data-value",start_time);
                $("#end_time").attr("data-value",end_time);
                $("#order").attr('data-value',order);

                change_page();
            }



    </script>
    <!--消费记录日期-->
    <script type="text/javascript">

            var start = {
                elem: '#start_two',
                format: 'YYYY-MM-DD',
                max: '2099-06-16 23:59:59',
                istime: false,
                istoday: true,
                choose: function(datas){
                    end.min = datas;
                    end.start = datas
                }
            };
            var end = {
                elem: '#end_two',
                format: 'YYYY-MM-DD',

                max: '2099-06-16 23:59:59',
                istime: false,
                istoday: true,
                choose: function(datas){
                    start.max = datas;
                }
            };
            laydate(start);
            laydate(end);
            function do_submit_two(){
                var start_time =   $("#form_two #start_two").val();
                var end_time =   $("#form_two #end_two").val();
                var  order = $("#form_two .order").val();
                $("#start_time").attr("data-value",start_time);
                $("#end_time").attr("data-value",end_time);
                $("#order").attr('data-value',order);
                change_page();
            }
   </script>
    <!--收支汇总日期-->
   <script type="text/javascript">

    var start = {
        elem: '#start_three',
        format: 'YYYY-MM-DD',
        max: '2099-06-16 23:59:59',
        istime: false,
        istoday: true,
        choose: function(datas){
            end.min = datas;
            end.start = datas
        }
    };
    var end = {
        elem: '#end_three',
        format: 'YYYY-MM-DD',

        max: '2099-06-16 23:59:59',
        istime: false,
        istoday: true,
        choose: function(datas){
            start.max = datas;
        }
    };
    laydate(start);
    laydate(end);
    function do_submit_three(){
        var start_time =   $("#form_three #start_three").val();
        var end_time =   $("#form_three #end_three").val();
        var  order = $("#form_three .order").val();
        $("#start_time").attr("data-value",start_time);
        $("#end_time").attr("data-value",end_time);
        $("#order").attr('data-value',order);
        change_page();
    }
</script>

    <!--切换页面-->
    <script type="text/javascript">

        var SiteUrl = $('#SiteUrl').val();
        function change_page(p) {

           if (typeof (p)=='undefined'){
                var p = '1';
            }
            var start_time =  $("#start_time").attr("data-value");
            var end_time = $("#end_time").attr("data-value");
            var order = $("#order").attr('data-value');


            var show = $('#show_project').attr('data-value');
            if (show ==''){
                show = 0;
            }

            $.ajax({
                type: "get",
                async: true,
                url: "/index.php/Service/"+action+"?action=AccountDetail&p="+p+'&show='+show+'&start='+start_time+'&end='+end_time+'&order='+order+"&b="+Math.random(),
                dataType: "html",
                data: '',

                success: function (msg) {
                    var show = $('.rtcnt');
                    show.text('');
                    show.prepend(msg)
                },
                error:  function (msg){
                    ////alert(msg.status)
                }
            })

        }



    </script>
  <!--内部异步调用-->
  <script type="text/javascript">
    $(document).ready(function () {
      $('.inter_chanView').click(function () {

            var action = $(this).attr('data-value');

            $.ajax({
                type: "get",
                async: true,
                url: "/index.php/Service/"+action+"?action="+action+"&b="+Math.random(),
                dataType: "html",
                data: '',
                cache:false,

                success: function (msg) {

                    var show = $('.rtcnt');
                    show.text('');
                    show.prepend(msg)
                },
                error:  function (msg){
                    ////alert(msg.status)
                }
            })
        });
    })

</script>
