
<!doctype html>
<html>
<head>
    <title>会员管理中心</title>
    <script language="javascript" type="text/javascript" src="__JS__/jquery.min.js"></script>
    <script src="__JS__/layer.js" type="text/javascript"></script>

    <link  href="__CS__/user.css" rel="stylesheet"  type="text/css">
    <include file="Public/head"/>
    <script src="__JS__/laydate/laydate.js" type="text/javascript"></script>
    <script type="text/javascript" src="__JS__/jquery.1.9.1.min.js"></script>
    <script src="__JS__/jquery.placeholder.min.js" type="text/javascript"></script>

     <script type="text/javascript" src="__JS__/ajaxfileupload.js" charset="UTF-8"></script>
    <script src="__JS__/tips.js" type="text/javascript"></script>
    <script type="text/javascript" src="__JS__/user.js"></script>
    <script type="text/javascript" src="__JS__/jquery.wluarmx.js"></script>
    <script src="__JS__/html5shiv.js"></script>
    <script src="__JS__/respond.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            layer.config({
                extend: 'extend/layer.ext.js'

            });
        })
    </script>

<?php
        /*获取传值*/
            $pid = I('pid');
        if($pid!=''){
         cookie('pid',$pid);

       }

        $cid = $_COOKIE['pid'];

            $cate = M('classify');
            $cate_list = $cate->where(array('pid'=>'1','type'=>array('neq','half')))->select();

?>	
	
	
<style>	
.input-file{
    display: inline-block;
    position: relative;
    overflow: hidden;
    text-align: center;
    width: auto;
    background-color: #2c7;
    border: solid 1px #ddd;
    border-radius: 4px;
    padding: 10px 18px;
    font-size: 22px;
    font-weight: normal;
    line-height: 38px;
    color: #fff;
    text-decoration: none;
}

.sa-file{
    display: inline-block;
    position: relative;
    overflow: hidden;
    text-align: center;
    width: auto;
    background-color: #fff;
    border: solid 0px #ddd;
    border-radius: 4px;
    padding: 10px 16px;
    font-size: 20px;
    font-weight: normal;
    line-height: 38px;
    color: #000;
    text-decoration: none;
}

.sa-file1{
    display: inline-block;
    position: relative;
    overflow: hidden;
    text-align: center;
    width: auto;
    background-color: #fff;
    border: solid 0px #ddd;
    border-radius: 4px;
    padding: 10px 16px;
    font-size: 20px;
    font-weight: normal;
    line-height: 38px;
    color: #000;
    text-decoration: none;
}



.input-file input[type="file"] {
    position: absolute;
    top: 0;
    right: 0;
    font-size: 14px;
    background-color: #fff;
    transform: translate(-300px, 0px) scale(4);
    height: 40px;
    opacity: 0;
    filter: alpha(opacity=0);
 }	
 
 
.send_btn {
    display: inline-block;
    display: none;
    float: right;
    /* margin-top: 20px; */
    padding: 7px 20px;
    font-size: 22px;
    color: white;
    margin-right: 330px;
    background: #0091f2;
    border: 1px solid transparent;
    border-radius: 2px;
    /* text-align: center; */
    cursor: pointer;
}
 
.send_btn1 {
    display: inline-block;
    display: none;
    float: right;
    /* margin-top: 20px; */
    padding: 7px 20px;
    font-size: 22px;
    color: white;
    margin-right: 330px;
    background: #0091f2;
    border: 1px solid transparent;
    border-radius: 2px;
    /* text-align: center; */
    cursor: pointer;
}
 
         #file_box {
            min-width: 600px;
            min-height: 300px;
            border: 1px solid #0091f2;
            border-radius: 10px;
            display: inline-block;
            background: #EEE;
            overflow: hidden;
            z-index: 999999;
        }

        #speed {
            width: 0;
            height: 100%;
            background: #0091f2;
            color: white;
            text-align: center;
            line-height: 20px;
            font-size: 16px;
        }

 
 
 
    </style>	
	
	
</head>
<body bgcolor="#efefef" class="pr">
<include file="Public/header"/>
<include file="Public/userheader"/>
<div class="clearfix">
    <input type="hidden" id="action" value="{$action}">
</div>
<div class="pcimain clearfix wrap ">

















<script type="text/javascript" language="javascript">


		function display() {

		//	$(".box").css('display', 'block');
          // popup($("#box8"));

		//	$(".box").css('display', 'block');
    document.getElementById('box8').style.display='block' ;

		}
		
		
		function disappear() {
			$(".box8").css('display', 'none');

		}
		
	
		
		
</script>	















    <div class="rtcnt fr">

   <div class="part1 clearfix">
   
   
   
   
   


<div class="rtmain" xmlns="http://www.w3.org/1999/html">
    <div class="hdtitle clearfix">
        <ul class="fl clearfix">
            <if condition="$info">
                <li class="on"><a href="javascript:void(0)">编辑作品</a></li>
                <else/><li class="on"><a href="javascript:void(0)">上传作品</a></li>
            </if>

        </ul>
    </div>

        <div class="ulfroms">
          <!--   <ul class="tlepic clearfix tlc1" style="width: 230px">
               <li>完善资料</li>
                <li>手机验证</li>
                <if condition="$info">
                    <li class="on">编辑素材</li>
                    <else/><li class="on">上传素材</li>
                </if>
				</ul>
-->
            
    <div class="upload-des">
        <ul class="upload-des-list">
            <li class="list-style-blue">上传AE模板、视频素材包等打包文件，请点击“添加模板/压缩包”，您需要同时添加压缩包及预览视频2个文件</li>
            <li class="list-style-blue">账户中满10个未提交审核的素材，上传将停止，提交审核后“开始”可继续</li>
            <li class="list-style-blue">上传素材后，请尽快完善素材信息，只有填写好信息的素材才会被审核</li>
            <li class="list-style-blue">请确保作品为原创，视频清晰，上传违规内容将影响账户权重降低素材排名


			</li>
        </ul>

    </div>
			
			

             <div style="padding-bottom:30px"></div>
			
			 
            <div class="wordlist clearfix yuan">
			
			
			
<!--
                <div class="nmse fl">源文件上传：{$info.data}</div>
                <div class="btn fl"><a href="javascript:;" onClick="$('#yuanjian').click();"><img src="__IMG__/dhscbtn.png"></a></div>
                <input type="hidden" id="yuanjian_s" name="yuanjian" value="{$info.opus_source}">
                <input type="file" id="yuanjian" name="file" value="" style="display:none"  onchange="ajaxFileUpload('yuanjian')">
				
		-->	
				

				
				
				
		    <form action="" method="" enctype="multipart/form-data">

<a class="input-file input-fileup" href="JavaScript:void(0)">
         + 上传源文件<input size="100" type="file" id="File" class="File" name="file" onchange="FileChangeFn1(event)">
		
</a>
<label id="file_size" class="sa-file1"></label> 
<button type="button" name="file" id="a-file" class="send_btn" onclick="UploadFileFn()">开始上传</button>
<div class="fileerrorTip1"></div>
<div class="showFileName1"></div>		



        <div class="clear"></div>
       </form>			
							
		
				
				
			
				
				
	    <form action="" method="" enctype="multipart/form-data">

<a class="input-file input-fileup1" href="JavaScript:void(0)">
         + 上传预览视频<input size="100"  type="file" id="File1" class="File" name="file" onchange="FileChangeFn(event)">
		
</a>
<label id="file_size1" class="sa-file"></label> 

<button type="button" name="file" id="a-file" class="send_btn1" onclick="UploadFileFns()">开始上传</button>
<div class="fileerrorTip12"></div>
<div class="showFileName12"></div>		



        

        <div class="clear"></div>
       </form>	

				 
				 </div>
                			

				
            </div>
	

            <div  id="imgbt" style="width:200px; height:160px;display:none">    <!--4图预览 显示控制框架-->
	
				<li>
                   <a href="javascript:;" onClick="$('#yulan1').click();"> <img id="img1" width="280" height="160" src="{$info.opus_pic_big}" style="display:none" BORDER=0></a>
				   <img id="img2" width="280" height="160" src="{$info.opus_pic_big}" style="display:none" BORDER=0>
				   
                </div>
               <div id="yulan1_sTip" style="display:none"></div>

                <input type="file" id="yulan" name="file"  style="display:none"  onchange="ajaxFileUpload('yulan')">


                <input type="file" id="yulan1" name="file"  style="display:none"  onchange="ajaxFileUpload('yulan1')">

         
           
			
			
			 <div  id="imgb" style="width:100%; height:100px; background-color:#F5F5F5; text-align:center; ">    <!--上传 显示控制框架-->
	
                <p id="pid" style="padding-top:30px;">暂时没有上传任务..</p>
  
			          <div class="speed_box">
                  <div id="speed"></div>
  
                       </div>
			  
			  
			  
			  
			</div>

		     <div id="btnsd1" class="btnsd1" style="padding-left:230px; padding-top:30px; display:none" >&nbsp;<input value="提交作品" type="submit" class="pay-btn1" onclick=""/>
			 </div>	

    <form action="{:U('Service/MaterialUploads')}" method="post" id="up_form" target="_blank">
  <div class="ulfroms">			 
			            <ul class="formsd biaoti" style="display:none">
			
                <li><label>作品标题：</label><input type="text" class="webtxt"  id="opus_title" name="opus_title" value="{$info.opus_title}"><span style="line-height:34px;margin-left:10px;"></span></li>
                <li><label>作品标价：</label><input type="text" class="webtxt"  id="opus_price" name="opus_price" value="{$info.price}"><span style="line-height:34px;margin-left:10px;">金币</span></li>
                <li><label>搜索标签：</label><input type="text" class="webtxt"  id="opus_keyword" name="opus_keyword" value="{$info.opus_keyword}"><span style="line-height:34px;margin-left:10px;"></span></li>

                <li><label>所属栏目：</label>
                   <select style="width:200px;height:30px;" name="cate" id="cate">
                       <if condition="$edit_cate">
                           <option value="{$edit_cate.path}-{$edit_cate.cid}" >{$edit_cate.name}</option>
                       </if>
                      <volist name="cate_list" id="list">
                          <option value="{$list.path}-{$list.cid}" >{$list.name}</option>
                      </volist></select>
                    

                      
                    
                    </li>



              <!-- <li><label>作品分类：</label></li>  
                <volist name="sort_list" id="list">
                    <li><label>{$list.name}：</label>
                        <select name="{$list['kind']}" id="{$list['kind']}" style="width:200px;height:30px;">
                            <if condition="$edit_list">
                                <option value="{$edit_list[$list['kind']].id='3'}" >{$edit_list[$list['kind']].name='时尚动感'}</option>

                            </if>
                            <option value="">默认为空</option>
                            <volist name="list['second']" id="lists">
                                 <option value="{$lists.id}" >{$lists.name}</option>
                            </volist>
                        </select>
                    </li>
                </volist>
-->
<div class="wordlist clearfix">
    <u style="padding-left:190px; font-size:16px;" >
        <label>免费将转换为L币：</label>
            <if condition="$info['is_half'] eq 1">
                <input type="checkbox" id="is_half" name="is_half" checked></li>
                <else/><input type="checkbox" id="is_half" name="is_half"></li>  
            </if>
            &nbsp;
            <label>透明通道：</label>
<if condition="$info['is_typ'] eq 1">
    <input type="checkbox" id="is_type" name="is_type" checked></li>
    <else/><input type="checkbox" id="is_type" name="is_type"></li>
</if>
&nbsp;
<label>无缝循环：</label>
<if condition="$info['is_typ1'] eq 1">
    <input type="checkbox" id="is_type1" name="is_type1" checked></li>
    <else/><input type="checkbox" id="is_type1" name="is_type1"></li>
</if>
</u>
</div>


<!--
                <if condition="$info['opus_fileurl']">
                    <li><label>上传文件：</label>上传源文件<input type="radio"  class="opus_method" name="method" value="1" >&nbsp;&nbsp;&nbsp;添加文件下载链接<input type="radio" name="method" value="2" class="opus_method" checked> </li>
                    <else/>
                    <li><label>上传文件：</label>上传源文件<input type="radio" checked  class="opus_method" name="method"  value="1" >&nbsp;&nbsp;&nbsp;添加文件下载链接<input type="radio" name="method" value="2" class="opus_method" > </li>
                </if>
                    <li class="down_url" style="display: none"><label>外部下载链接：</label><input type="text" class="webtxt"  id="down_url" name="down_url" value="{$info.opus_fileurl}"></li>
                    <li class="down_url" style="display: none"><label>密码：</label><input type="text" class="webtxt"  id="pass" name="pass" value="{$info.opus_zippass}"></li>

				-->	
					
					
                 </ul> 

            <if condition="$info">
                <input type="hidden" name="edit" value="true">
                <input type="hidden" name="opus_id" value="{$info.opus_id}">
            </if>

			
 <input type="hidden" id="yuanjian_s" name="yuanjian" value="{$info.opus_source}">			
				
    <input type="hidden" id="zhanshi_s" name="zhanshi" value="{$info.opus_pic}">	
	
   <input type="hidden" id="yulan_s" name="yulan" value="{$info.opus_pic_big}">	

                <input type="hidden" id="yulan1_s" name="yulan1" value="{$info.opus_pic_big}">
   
	</div>	
	
	
	<div class="btnsd" style="display:none"><input value="提交审核" type="submit" class="pay-btn" /></div>
	
    </form>
    <form action="{:U('Upload/upload')}" method="post" enctype="multipart/form-data" id="j-uploadFile-form" style="position: absolute;left: -9999px;top: -9999px;" target="j-uploadFile-iframe"></form>
    <iframe id="j-uploadFile-iframe" name="j-uploadFile-iframe" style="position: absolute;left: -9999px;top: -9999px;"></iframe>
</div>





   </div>

</div>

</div>





<script>

        //文件选择完毕时
        function FileChangeFn(event) {
         //   $('.opst_txt').text('重新选择文件');
            $('.send_btn1').show();
            var event = event || window.event,
                dom = '',
                file = $("#File1").get(0).files[0],
                otype = file.type || '获取失败',
                osize = file.size / 1054000,
                ourl = window.URL.createObjectURL(file); //文件临时地址
            $('#file_type1').text("选择上传文件类型：" + otype);
            $('#file_size1').text("上传文件大小，共" + osize.toFixed(2) + "MB。");
            pid.innerHTML = '<span style="color: red">准备上传</span>';
            console.log("文件类型：" + otype); //文件类型
            console.log("文件大小：" + osize); //文件大小

            if ('video/mp4' == otype || 'video/avi' == otype || 'video/mov' == otype || 'video/MOV' == otype) {
			 $('.send_btn1').show();
                dom = '<video id="video" width="100%" height="100%" controls="controls" autoplay="autoplay" src=' + ourl + '></video>';
            }

            $('#file_box').html(dom);
        };

        var uploadUrl = 'http://127.0.0.1/index.php/Upload/upload';

        //侦查附件上传情况 ,这个方法大概0.05-0.1秒执行一次
        function OnProgRess(event) {
            var event = event || window.event;
            console.log(event);  //事件对象
         //   console.log("已经上传：" + event.loaded); //已经上传大小情况(已上传大小，上传完毕后就 等于 附件总大小)
            //console.log(event.total);  //附件总大小(固定不变)
            var loaded = Math.floor(100 * (event.loaded / event.total)); //已经上传的百分比  
            $("#speed").html(loaded + "%").css("width", loaded + "%");
        };

        //开始上传文件
        function UploadFileFns() {

            $('.speed_box').show();
            var File = $("#File1").get(0).files[0]; //input file标签

            pid.innerHTML = '<span style="color: red">上传中..请不要随意点击按钮！</span>';

            var formData = new FormData(); //创建FormData对象
            var xhr = $.ajaxSettings.xhr(); //创建并返回XMLHttpRequest对象的回调函数(jQuery中$.ajax中的方法)
            formData.append("file", File); //将上传name属性名(注意：一定要和 file元素中的name名相同)，和file元素追加到FormData对象中去


			  if ($("#speed").html()=="100%") {
			            pid.innerHTML = '<span style="color: red">开始做图片处理，请稍等..</span>';
               }	

			   
            $.ajax({
                type: "POST",
                url: uploadUrl, // 后端服务器上传地址
                data: formData, // formData数据
                cache: false, // 是否缓存
                async: true, // 是否异步执行
                processData: false, // 是否处理发送的数据  (必须false才会避开jQuery对 formdata 的默认处理)
                contentType: false, // 是否设置Content-Type请求头
                xhr: function () {
                    if (OnProgRess && xhr.upload) {
                        xhr.upload.addEventListener("progress", OnProgRess, false);
                        return xhr;
                    }
                },
                success: function (returndata) {


                    returndata=JSON.parse(returndata);
                   // console.log(returndata);
                    if (returndata.error == 0) {								
                    //  layer.msg(data.msg,{time:1000});
					   alert(returndata.message);
                        $("#speed").html("上传成功");
            pid.innerHTML = '<span style="color: red">暂时没有上传任务..</span>';	

						if(returndata.video1){
                                $('#yulan_s').attr('value',returndata.img);
                                $('#yulan1_s').attr('value',returndata.img5);
                                $('#zhanshi_s').attr('value',returndata.video1);
                                $('#img1').attr('src',returndata.img5);
								 $('.btnsd1').attr('style','display:block')
                             }
							   
							   
							//   else if(returndata.img8){ 
							//   $('#img1').attr('src',returndata.img8);
							//   $('#yulan1_s').attr('value',returndata.img8);
							//   $('#img1').attr('style','display:none')

							//  }  
			
                    } else if (returndata.error == 6) {
                        alert(returndata.message);
            pid.innerHTML = '<span style="color: red">文件重复请重新选择文件！</span>';						
                    } else {
                        alert(returndata.message);
                    }
                    //   } catch (e) {
                    //alert('上传失败，请重试!');
                    //   }
                    //  }


                },
                error: function (returndata) {
                    $("#speed").html("上传失败");
                    console.log(returndata)
                    alert('请正确配置后台服务！');
                }
            });



        };
    </script>	








<script type="text/javascript">
    head.ready('formvalidator',function(){

      $.formValidator.initConfig({autotip:true,formid:"up_form",onerror:function(msg){}});
     $("#opus_title").formValidator({onshow:"请使用简洁，鲜明的标题",onfocus:"输入作品名称",oncorrect:" 已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});
        $("#opus_price").formValidator({onshow:"价格",onfocus:"请输入价格",oncorrect:"已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});
      $("#opus_keyword").formValidator({onshow:"此项用于搜索作品，请填写短词语，用减号（-）隔开",onfocus:"添加关键词用减号（-）隔开",oncorrect:"已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});
       if($('.opus_method').eq(0).attr('checked')=='checked'){
            $("#yuanjian_s").formValidator({onshow:"，支持 'rar', 'zip' 格式，体积在300MB以下",onfocus:"使用简洁的标题",oncorrect:"已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});
        }
    // $("#zhanshi_s").formValidator({onshow:"等待上传，支持'flv', 'mov', 'mp4'格式",onfocus:"使用简洁的标题",oncorrect:"已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});
	 
  //   $("#yulan1_s").formValidator({onshow:"等待上传，支持'flv', 'mov', 'mp4'格式",onfocus:"使用简洁的标题"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"})    
       if($('.opus_method').eq(1).attr('checked')=='checked'){
             $("#down_url").formValidator({onshow:"文件下载链接",onfocus:"填写链接",oncorrect:"已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});

       }

        // $("#cate").formValidator({onshow:"所属栏目，必选项",onfocus:"选择栏目",oncorrect:"已填"}).regexValidator({regexp:"notempty",datatype:"enum",onerror:"必填项"});





    });
</script>



<script>
        $(function(){
            $(".input-fileup").on("change","input[type='file']",function(){
                var filePath=$(this).val();
                if(filePath.indexOf("rar")!=-1 || filePath.indexOf("zip")!=-1){
                    $(".fileerrorTip1").html("").hide();
                    var arr=filePath.split('\\');
                    var fileName=arr[arr.length-1];
                    $(".showFileName1").html(fileName);
               //     $(".fileerrorTip1").html("").hide();	

				
                }else{
                    $(".showFileName1").html("");
                    $(".fileerrorTip1").html("您上传文件类型有误源码为rar zip 格式！").show();
                    return false
                }
            })
			
			
            $(".input-fileup1").on("change","input[type='file']",function(){
                var filePath=$(this).val();
                if(filePath.indexOf("mp4")!=-1 || filePath.indexOf("mov")!=-1  || filePath.indexOf("avi")!=-1){
                    $(".fileerrorTip1").html("").hide();
                    var arr=filePath.split('\\');
                    var fileName=arr[arr.length-1];
                    $(".showFileName12").html(fileName);
                    $(".fileerrorTip12").html("").hide();					
                }else{
                    $(".showFileName12").html("");
                    $(".fileerrorTip12").html("您上传作品有误为mp4 mov avi 格式！").show();
                    return false
                }
            })
						
			
			
			
        })
    </script>



	

    <script>

        //文件选择完毕时
        function FileChangeFn1(event) {
            $('.opst_txt').text('重新选择文件');
            $('.send_btn').show();
            var event = event || window.event,
                dom = '',
                file = $("#File").get(0).files[0],
                otype = file.type || '获取失败',
                osize = file.size / 1054000,
                ourl = window.URL.createObjectURL(file); //文件临时地址
            $('#file_type').text("选择上传文件类型：" + otype);
            $('#file_size').text("上传文件大小，共" + osize.toFixed(2) + "MB。");
            pid.innerHTML = '<span style="color: red">准备上传</span>';
            console.log("文件类型：" + otype); //文件类型
            console.log("文件大小：" + osize); //文件大小

            if ('video/mp4' == otype || 'video/avi' == otype || 'video/x-msvideo' == otype) {
                dom = '<video id="video" width="100%" height="100%" controls="controls" autoplay="autoplay" src=' + ourl + '></video>';
            }
            if ('audio/mp3' == otype || 'audio/wav' == otype || 'audio/x-m4a' == otype) {
                dom = '<audio id="audio" width="100%" height="100%" controls="controls" autoplay="autoplay" loop="loop" src=' + ourl + ' ></audio>';
            }
            if ('image/jpeg' == otype || 'image/png' == otype || 'image/gif' == otype) {
                dom = '<img id="photo" width="100%" height="100%" alt="我是image图片文件" src=' + ourl + ' title="" />';
            }
            $('#file_box').html(dom);
        };

        var uploadUrl = 'http://127.0.0.1/index.php/Upload/upload';

        //侦查附件上传情况 ,这个方法大概0.05-0.1秒执行一次
        function OnProgRess(event) {
            var event = event || window.event;
            //console.log(event);  //事件对象
            console.log("已经上传：" + event.loaded); //已经上传大小情况(已上传大小，上传完毕后就 等于 附件总大小)
            //console.log(event.total);  //附件总大小(固定不变)
            var loaded = Math.floor(100 * (event.loaded / event.total)); //已经上传的百分比  
            $("#speed").html(loaded + "%").css("width", loaded + "%");
        };

        //开始上传文件
        function UploadFileFn() {

            $('.speed_box').show();
            var File = $("#File").get(0).files[0]; //input file标签

            pid.innerHTML = '<span style="color: red">上传中..请不要随意点击按钮！</span>';

            var formData = new FormData(); //创建FormData对象
            var xhr = $.ajaxSettings.xhr(); //创建并返回XMLHttpRequest对象的回调函数(jQuery中$.ajax中的方法)
            formData.append("file", File); //将上传name属性名(注意：一定要和 file元素中的name名相同)，和file元素追加到FormData对象中去

    //  var xhrs = formData.append("file", File);
          //  console.log(xhrs);

            $.ajax({
                type: "POST",
                url: uploadUrl, // 后端服务器上传地址
                data: formData, // formData数据
                cache: false, // 是否缓存
                async: true, // 是否异步执行
                processData: false, // 是否处理发送的数据  (必须false才会避开jQuery对 formdata 的默认处理)
                contentType: false, // 是否设置Content-Type请求头
                xhr: function () {
                    if (OnProgRess && xhr.upload) {
                        xhr.upload.addEventListener("progress", OnProgRess, false);
                        return xhr;
                    }
                },
                success: function (returndata) {


                    returndata=JSON.parse(returndata);

                    if (returndata.error == 0) {

					   alert(returndata.message);

                        $("#speed").html("上传成功");
            pid.innerHTML = '<span style="color: red">暂时没有上传任务..</span>';							
					 $('#yuanjian_s').attr('value',returndata.filePath);
						
                    } else if (returndata.error == 6) {
                        alert(returndata.message);
            pid.innerHTML = '<span style="color: red">文件重复请重新选择文件！</span>';								
                    } else {
                        alert(returndata.message);
                    }
                    //   } catch (e) {
                    //alert('上传失败，请重试!');
                    //   }
                    //  }


                },
                error: function (returndata) {
                    $("#speed").html("上传失败");
                    console.log(returndata)
                    alert('请正确配置后台服务！');
                }
            });



        };
    </script>



























  <if condition="$info['opus_fileurl']">
    <script type="text/javascript">

        $('.yuan').attr('style','display:none');
        $('.down_url').attr('style','display:block')
    </script>

    <else/>
    <script type="text/javascript">

        $('.yuan').attr('style','display:block');
        $('.down_url').attr('style','display:none')
    </script>
</if>
<!--文件方式-->
<script type="text/javascript">

  $('.opus_method').click(function () {
      var i =  $(this).index();

        if(i=='1'){
            $('.yuan').attr('style','display:block')
            $('.down_url').attr('style','display:none')
        }if(i=='2'){

            $('.down_url').attr('style','display:block')
            $('.yuan').attr('style','display:none')
        }

    })
	
$(function(){
//var btn = document.getElementById("btn"); 

//通用方法 
btnsd1.onclick = function() { 

alert("正在进入提交页面，请确定操作..");
$('#imgbt').attr('style','display:block')				
$('#img1').attr('style','display:block')
$('.biaoti').attr('style','display:block')
$('.btnsd').attr('style','display:block')
$('.yuan').attr('style','display:none');
$('#yuanjian_sTip').attr('style','display:none');
$('.yuan').attr('style','display:none');
$('#yuanjian_sTip').attr('style','display:none');
//$('#yulan1_sTip').attr('style','display:block')	
 $('.btnsd1').attr('style','display:none')
}

  yuanjian.onchange = function() { 

//alert("正在上传，请确定操作..");
//$('#imgbt').attr('style','display:block')		
ajaxFileUpload('yuanjian')		
 pid.innerHTML = '<span style="color: red">正在上传</span>';
 $('#jiance').attr('src','__IMG__/s002.gif');
}

  zhanshi.onchange = function() { 

ajaxFileUpload('zhanshi')		
 pid.innerHTML = '<span style="color: red">正在上传</span>';
 $('#jiance').attr('src','__IMG__/s002.gif');
 $('.btnsd1').attr('style','display:block')
}

  yulan1.onchange = function() { 

ajaxFileUpload('yulan1')		
 pid.innerHTML = '<span style="color: red">正在上传</span>';
 $('#jiance').attr('src','__IMG__/s002.gif');
 $('.btnsd1').attr('style','display:block')
}


 })	






 
	
</script>

































<script type="text/javascript">
   function ajaxFileUpload(name){

               var oInp = $('#'+name);
               var oNewInp = oInp.clone(true);
               var oForm = $('#j-uploadFile-form');
               var oIframe = $('#j-uploadFile-iframe');
               oInp.before(oNewInp);

               oInp.removeAttr('id').removeAttr('class').appendTo(oForm);

               oIframe.on('load', function(e){
                   oIframe.off('load');
                   var sRet = this.contentWindow.document.body.innerHTML;
                   oForm.empty();
                   if (sRet && sRet.length) {
                       try {
                           var oRet = $.parseJSON(sRet);
                           if (oRet.error == 0) {
                           // $('#yulan_s').val(oRet.img);

                               $('#yuanjian_s').attr('value',oRet.filePath);
                            //  if($('#yuanjian_s').attr('value',oRet.filePath)!=""){
							   
							 
                               pid.innerHTML = '暂时没有上传任务..';
                               $('#jiance').attr('src','__IMG__/s001.png');
							//  }

							$('#yuanjian_sTip').html('<span style="color: red">上传完成</span>');
							
							
							   
							  if(oRet.video1){
                                $('#yulan_s').attr('value',oRet.img);
                                $('#yulan1_s').attr('value',oRet.img5);
                                $('#zhanshi_s').attr('value',oRet.video1);
                                $('#img1').attr('src',oRet.img5);
							   pid.innerHTML = '暂时没有上传任务..';
                               $('#jiance').attr('src','__IMG__/s001.png');
                               }else if(oRet.img8){ 
							   $('#img1').attr('src',oRet.img8);
							   $('#yulan1_s').attr('value',oRet.img8);
							   $('#img2').attr('style','display:block')
							   $('#img1').attr('style','display:none')
							   pid.innerHTML = '暂时没有上传任务..';
                               $('#jiance').attr('src','__IMG__/s001.png');
							  }  

                               layer.msg(oRet.message);

                               /*$('#'+name).attr('src',oRet.filePath);
                               $("#img_in").attr('src',oRet.filePath);
                               $("#service_img").attr('src',oRet.filePath)*/
                           } else if(oRet.error == 6) {
                               layer.msg(oRet.message);
							   pid.innerHTML = '暂时没有上传任务..';
                               $('#jiance').attr('src','__IMG__/s001.png');
							    $('.btnsd1').attr('style','display:none')
                           }
                       } catch (e) {
                           //alert('上传失败，请重试!');
                       }
                   }
               });

               oForm.submit();


   }

</script>

