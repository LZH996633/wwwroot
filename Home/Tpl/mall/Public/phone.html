<link  href="__CS__/user.css" rel="stylesheet"  type="text/css">
<script language="javascript" type="text/javascript" src="__JS__/jquery.min.js"></script>
<script src="__JS__/layer.js" type="text/javascript"></script>
<div class="rtmain">

    <div class="uspictm ">

        <div class="contms">
            <!-- <form method="post" action=""  id="myform" name="myform">-->
            <dl>

                <dd><label>手机号：</label><span class="pr"><input type="text" name="mobile" id="mobile" class="webtxt" value="" ><input  type="button" id="sendsms"  value="发送验证码" class="pa"  style="right:0px;top:0px;height:32px;line-height:32px;border:none;background-color:#6bc85c;color:#fff;padding:0 10px"></span><div id="mobileTip" class="onShow">请输入手机号</div></dd>
                <dd><label>验证码：</label><span><input name="verify" type="text" id="verify" class="webtxt" placeholder=""></span><div id="verifyTip" class="onShow">请输入验证码</div></dd>
                <dd><input type="submit"  id="dosubmit" class="webtn" disabled="true" style="background-color:#a9a9a9;border-radius:5px" value="登 录"></dd>
            </dl>
            <!--   </form>-->
        </div>

    </div>
</div>
<!--手机验证-->
<script type="text/javascript">

    var times = 120;
    var isinerval;
    var mobilereg=/^(1)[0-9]{10}$/;
    var verifyreg=/^[0-9]{6}$/;
    function CountDown() {
        if (--times < 1) {
            $("#sendsms").val("发送验证码").attr("disabled", false).css({'background-color':'#6bc85c'});

            clearInterval(isinerval);
            return;
        }
        $("#sendsms").val(times+" 秒后可重发");

    }

    $(function(){
        $("#sendsms").click(function(){
            var mobile = $("#mobile").val();

            $.getJSON("/index.php/Ajax/send_msg?mobile="+mobile,function(data){

                if(data.status==1){
                    layer.msg("验证码已发送",{time: 2000},function(){
                        times=60;
                        $("#sendsms").attr("disabled", true).css({'background-color':'#a9a9a9'});

                        isinerval = setInterval("CountDown()", 1000);
                    });
                }else{
                    layer.msg(data.msg+data.con,{time: 2000});
                    times=60;
                    $("#sendsms").attr("disabled", true).css({'background-color':'#a9a9a9'});

                    isinerval = setInterval("CountDown()", 1000);
                }
            });
        });
        $("#mobile").keyup(function(){
            if($(this).val()==""){
                $("#mobileTip").attr("class","onError").html("手机号不能为空");
                //$("#sendsms").attr("disabled", true).css({'background-color':'#a9a9a9'});
                $(this).focus();
                return;
            }else if(!mobilereg.test($(this).val())){
                $("#mobileTip").attr("class","onError").html("手机号格式错误");
                //$("#sendsms").attr("disabled", true).css({'background-color':'#a9a9a9'});
                $(this).focus();
            }else{
                $("#mobileTip").attr("class","onCorrect").html("手机号格式正确");
            }
        });
        $("#verify").keyup(function(){
            var mobile = $("#mobile").val();
            var verify = $(this).val();
            if($(this).val()==""){
                $("#verifyTip").attr("class","onError").html("验证码不能为空");
                $("#dosubmit").attr("disabled",true).css({'background-color':'#a9a9a9'});
                //$(this).focus();
                return;
            }else if(!verifyreg.test($(this).val())){
                $("#verifyTip").attr("class","onError").html("验证码格式错误");
                $("#dosubmit").attr("disabled",true).css({'background-color':'#a9a9a9'});
                //$(this).focus();
            }else{
                $.getJSON("/index.php/Ajax/check_verify?mobile="+mobile+"&verify="+verify,function(data){

                    if(data.status=="1"){
                        $("#verifyTip").attr("class","onCorrect").html(data.msg);
                        $("#dosubmit").attr("disabled",false).css({'background-color':'#6bc85c'});

                    }else{
                        $("#verifyTip").attr("class","onError").html(data.msg);
                        $("#dosubmit").attr("disabled",true).css({'background-color':'#a9a9a9'});

                    }
                });
            }
        });
        $("#dosubmit").click(function () {
            $.getJSON("/index.php/Ajax/phone_write?action=login",function(data) {

                if(data.status==1){
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                }else{
                    layer.msg(data.msg,{icon:5})
                }
            });

        });
    });

    function filtescript(data){
        var result=data.replace(/<script.*?>.*?<\/script>/ig, '');
        return JSON.parse(result);
    }


</script>

